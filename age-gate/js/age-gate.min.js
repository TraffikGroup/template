/*
 *	DIAGEO AGE GATE
 *	version 3.0
 *	October 2012
 */
(function(e){e.agegate=function(t){function r(t){if(top.location!==location)top.location.href=document.location.href;$(".age-gate").append("<div class='loader'></div>");var n={day:t.default_day,month:t.default_month,year:t.default_year,regExp:/^[0-9]*$/,cookies_enabled:i()};var r={pass:t.bypass,country:"",language:"",day:n.day,month:n.month,year:n.year};var d=function(){if(n.cookies_enabled){return true}else{if(t.use_local_storage&&true){return true}else{return false}}};$(document).ready(function(){var i=$("<div></div>");if(!d()){i.load("age-gate/no-cookies.html",function(){$(".age-gate .loader").hide().remove();$(t.age_gate_element).append(i)})}else{var v=o("diageo-age-gate");if(t.use_local_storage&&!v)v=JSON.parse(localStorage.getItem("diageo-age-gate"));if(v&&v.pass===true||t.bypass===true){$(t.age_gate_element).fadeOut("fast",function(){$(t.curtain_element).fadeOut("fast",function(){$("this").remove()});$(this).remove();$(window).unbind("resize.agegateway");t.callback();e.agegate=""})}else{i.load("age-gate/age-gate.html",function(){function i(){var i={country:$(".age-gate .country"),language:$(".age-gate .language"),day:$(".age-gate .day"),month:$(".age-gate .month"),year:$(".age-gate .year"),rememberme:$(".age-gate .remember-me-checkbox"),submit:$(".age-gate .submit")};i.country.find("option[value="+t.default_country+"]").attr("selected","selected");i.language.find("option[value="+t.default_language+"]").attr("selected","selected");if(t.use_textboxes){i.day.val(n.day);i.month.val(n.month+1);i.year.val(n.year);i.day.blur(function(){var e=$(this);if(!n.regExp.test(e.val()))e.val(n.day);var t=a(new Number(i.month.val())+0,u(i.year.val()));if(e.val()>t)e.val(t);if(e.val()<1)e.val(1)});i.month.blur(function(){var e=$(this);if(!n.regExp.test(e.val()))e.val(n.month);var t=a(new Number(e.val())+0,u(i.year.val()));if(i.day.val()>t)i.day.val(t);if(e.val()>12)e.val(12);if(e.val()<1)e.val(1)});i.year.blur(function(){var e=$(this);if(!n.regExp.test(e.val()))e.val(n.year);if(e.val()<1900)e.val(n.year);if(e.val()>n.year)e.val(n.year)})}else{i.month.change(function(){f(i.day,a(new Number(this.value)+1,u(i.year.val())))});i.year.change(function(){f(i.day,a(new Number(i.month.val())+1,u(i.year.val())))})}if(v)l(v,i);i.day.focus(function(){$(".dob-error").hide().remove()});i.month.focus(function(){$(".dob-error").hide().remove()});i.year.focus(function(){$(".dob-error").hide().remove()});i.country.focus(function(){$(".country-error").hide().remove()});i.submit.click(function(n){n.preventDefault();$(".error").hide().remove();var o={day:i.day.val(),month:i.month.val(),year:i.year.val(),country:i.country.val(),language:i.language.val(),rememberme:i.rememberme.attr("checked")};if(c(o.country)){if(h(o.day,o.month,o.year,o.country,t.use_textboxes)){r.pass=true;r.day=o.day;r.month=o.month;r.year=o.year;r.country=o.country;r.language=o.language;if(o.rememberme!==undefined){s("diageo-age-gate",JSON.stringify(r),t.domain,t.cookie_expiry_days)}else{s("diageo-age-gate",JSON.stringify(r),t.domain)}if(t.use_local_storage)localStorage.setItem("diageo-age-gate",JSON.stringify(r));$(t.age_gate_element).fadeOut("fast",function(){$(t.curtain_element).fadeOut("fast",function(){$("this").remove()});$(this).remove();$(window).unbind("resize.agegateway");t.callback();e.agegate=""})}else{$(".year-div").append("<div class='error dob-error'>"+t.dob_error.replace("%age%",p(i.country.val()))+"</div>");$(".dob-error").css("top");$(".dob-error").toggleClass("active");if(t.redirect){var u=t.redirect_time_limit;var a=setInterval(function(){u--;if(u===0){if(t.redirect_http===true)window.location.replace(t.redirect_target);else window.location.href=t.redirect_target;clearInterval(a)}},1e3)}}}else{$(".country-div").append("<div class='error country-error'>"+t.invalid_country_error+"</div>");$(".country-error").css("top");$(".country-error").toggleClass("active")}})}$(".age-gate .loader").hide().remove();$(t.age_gate_element).append(this);$(".dob-inputs").append("<div class='loader'></div>");if(t.use_textboxes){$(".dob-inputs").load("age-gate/dob-inputs-text.html",function(){$(".age-gate .loader").hide().remove();$(this).addClass("textboxes");i()})}else{$(".dob-inputs").load("age-gate/dob-inputs-select.html",function(){$(".age-gate .loader").hide().remove();$(this).addClass("selects");i()})}})}}})}function i(){var e=navigator.cookieEnabled?true:false;if(typeof navigator.cookieEnabled=="undefined"&&!e){document.cookie="testcookie";e=document.cookie.indexOf("testcookie")!=-1?true:false}if(!e){document.cookie="testcookie";e=document.cookie.substring(document.cookie.length-10,document.cookie.length)=="testcookie"}return e}function s(e,t,n,r){t=t.replace(/"/g,"'");if(r){var i=new Date;i.setTime(i.getTime()+r*24*60*60*1e3);var s=";expires="+i.toGMTString()}else var s="";document.cookie=e+"="+t+s+"; domain="+n+"; path=/"}function o(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0){var s=i.substring(t.length,i.length);s=s.replace(/'/g,'"');return jQuery.parseJSON(s)}}return null}function u(e){var t=false;if(e%4==0){if(e%100==0){t=e%400==0}else{t=true}}else{t=false}return t}function a(e,t){var n=31;switch(e){case 2:if(t)n=29;else n=28;break;case 4:case 6:case 9:case 11:n=30;break;default:n=31}return n}function f(e,t){var n=e.find("option").length;if(n>t){for(var r=n;r>t;r--){e.append("<span></span>");if(e.find("option[value="+r+"]").attr("selected")=="selected")e.find("option[value="+(r-1)+"]").attr("selected","selected");e.find("option[value="+r+"]").remove()}}else{for(var r=n+1;r<=t;r++){e.append("<span></span>");e.append("<option value='"+r+"'>"+r+"</option>")}}e.css({width:"100% !important"})}function l(e,t){t.country.find("option[value="+e.country+"]").attr("selected","selected");t.language.find("option[value="+e.language+"]").attr("selected","selected");if(n.use_textboxes){t.day.val(e.day);t.month.val(e.month);t.year.val(e.year)}else{t.day.find("option[value="+e.day+"]").attr("selected","selected");t.month.find("option[value="+e.month+"]").attr("selected","selected");t.year.find("option[value="+e.year+"]").attr("selected","selected")}}function c(e){if(p(e)>0)return true;else return false}function h(e,t,n,r,i){if(i)t--;var s=false;var o=new Date(n,t,e);var u=new Date;if(i)var a=new Date(u.getFullYear()-p(r),u.getMonth(),u.getDate());else var a=u.setFullYear(u.getFullYear()-p(r));if(o<=a){s=true}else{s=false}return s}function p(e){var t=18;switch(e){case"0":t=-1;break;case"AE":t=21;break;case"AF":t=0;break;case"AZ":t=0;break;case"BD":t=0;break;case"BH":t=21;break;case"BN":t=0;break;case"CA":t=19;break;case"EG":t=0;break;case"ET":t=0;break;case"FR":t=0;break;case"HN":t=21;break;case"ID":t=21;break;case"IN":t=25;break;case"IQ":t=0;break;case"IR":t=0;break;case"IS":t=0;break;case"JO":t=0;break;case"JP":t=20;break;case"KG":t=0;break;case"KR":t=19;break;case"KW":t=0;break;case"KZ":t=0;break;case"LY":t=0;break;case"NO":t=0;break;case"NP":t=0;break;case"OM":t=21;break;case"PK":t=0;break;case"PW":t=21;break;case"PY":t=20;break;case"SA":t=0;break;case"SB":t=21;break;case"SD":t=0;break;case"SE":t=0;break;case"SY":t=0;break;case"TJ":t=0;break;case"TM":t=0;break;case"US":t=21;break;case"UZ":t=0;break;case"WS":t=21;break;case"YE":t=0;break;default:t=18;break}return t}if(!(typeof t==="object"))t={};var n={age_gate_element:t.age_gate_element||".age-gate",curtain_element:t.curtain_element||".curtain",domain:t.domain||"diageo.com",cookie_expiry_days:t.cookie_expiry_days||30,use_textboxes:t.use_textboxes||false,use_local_storage:t.use_local_storage||false,invalid_country_error:t.invalid_country_error||"Sorry, access from this country is not permitted.",dob_error:t.dob_error||"You must be at least %age% to enter this site.",redirect:t.redirect||false,redirect_http:t.redirect_http||true,redirect_target:t.redirect_target||"https://brand.com",redirect_time_limit:t.redirect_time_limit||10,callback:t.callback||function(){},default_country:t.default_country||"CA",default_language:t.default_language||"English",default_day:t.default_day||(new Date).getDate(),default_month:t.default_month||(new Date).getMonth(),default_year:t.default_year||(new Date).getFullYear(),bypass:t.bypass||false};r(n)}})(this)